#!/usr/bin/env node

//var createServer = require('auto-sni')
var hapi = require('hapi')
var server = new hapi.Server()
var argv = require('minimist')
/*
var secureServer = createServer({
  email: 'm@we-are-root.com',
  agreeTos: true
})
*/

server.connection({
  port: 8081
})
server.register([{
  register: require('good'),
  options: {
    opsInterval: 1000,
    reporters: [{
      reporter: require('good-console'),
      events: { log: '*', response: '*', error: '*' }
    }]
  }
}, {
  register: require('../lib/hapiPlugin.js'),
  options: {
    githubOrganization: process.env.GITHUB_ORG,
    githubApiToken: process.env.GITHUB_TOKEN,
    webhookSecret: process.env.SECRET
  }
}], function (err) {
  if (err) throw err
  server.start(function (err) {
    if (err) throw err
    console.log('Server running at:', server.info.uri)
  })
})
